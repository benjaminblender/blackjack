<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Blackjack Pro ‚Äî Hi-Lo Live Analyzer</title>
<style>
:root{--bg:#071014;--panel:#0d1a1f;--accent:#00d18a;--muted:#9aa9b0;--danger:#ff6b6b;--card:#0b2a2a}
body{background:var(--bg);color:#ecf6f5;font-family:Inter,system-ui,Segoe UI,Arial;margin:0;padding:18px}
header{display:flex;gap:12px;align-items:center}
h1{margin:.2rem 0;color:var(--accent)}
.container{display:grid;grid-template-columns:360px 1fr;gap:18px;margin-top:12px}
.panel{background:var(--panel);padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.6)}
label{display:block;color:var(--muted);font-size:12px;margin-top:8px}
input[type=text], input[type=number], textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #153236;background:#071f20;color:#e8f7f2}
button{background:var(--accent);color:#00220f;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;margin-top:8px}
.smallbtn{padding:6px 8px;font-size:13px}
.row{display:flex;gap:8px;align-items:center}
.stat{margin:8px 0;padding:10px;border-radius:10px;background:linear-gradient(180deg,#062b30,#052025);font-size:14px}
.muted{color:var(--muted);font-size:13px}
.badge{display:inline-block;padding:6px 8px;border-radius:8px;background:#022523;color:#a8f6df;margin-right:6px;font-weight:600}
.danger{background:var(--danger);color:#2b0000}
.hands{display:flex;gap:12px;flex-wrap:wrap}
.hand{min-width:180px;padding:10px;border-radius:10px;background:#071f22}
.cards{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.card{background:var(--card);padding:8px 10px;border-radius:8px;min-width:30px;text-align:center;font-weight:700}
footer{position:fixed;left:18px;bottom:18px;display:flex;align-items:center;gap:10px}
.countdot{width:14px;height:14px;border-radius:50%;display:inline-block;border:2px solid #0a2f26}
.green{background:#17d18a;box-shadow:0 0 8px #17d18a66}
.red{background:#ff6b6b;box-shadow:0 0 8px #ff6b6b66}
.log{max-height:160px;overflow:auto;padding:8px;background:#051517;border-radius:8px;margin-top:8px;font-size:13px}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.mini{font-size:13px;padding:6px 8px}
.center{display:flex;align-items:center;gap:8px}
.settings{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.hint{font-size:13px;color:var(--muted)}
</style>
</head>
<body>

<header>
  <div>
    <h1>üÉè Blackjack Pro ‚Äî Hi-Lo Live Analyzer</h1>
    <div class="muted">Continuous count ‚Ä¢ Splits, doubles ‚Ä¢ Dealer draws & other players ‚Ä¢ Bankroll & betting</div>
  </div>
</header>

<div class="container">

<div class="panel">
  <label>Decks (N#)</label>
  <div class="row">
    <input id="numDecks" type="number" min="1" max="8" value="6"/>
    <button class="smallbtn" onclick="setDecks()">Set N</button>
    <button class="smallbtn" onclick="fullReset()">Reset All</button>
  </div>

  <label>Initial Setup</label>
  <input id="setup" placeholder="Example: D10 P9,7 O7,3 ‚Äî N optional if set above" />
  <div class="row">
    <button onclick="processInput()">Analyze / Start Hand</button>
    <button class="smallbtn" onclick="nextRound()">Next Round</button>
  </div>
  <div class="hint">D=Dealer, P=Your cards (comma-separated), O=Other players‚Äô cards</div>

  <hr style="opacity:.08;margin:10px 0">

  <label>Add Player Card</label>
  <div class="row">
    <input id="addCard" placeholder="e.g. 9" />
    <button class="smallbtn" onclick="addCard()">Add</button>
    <button class="smallbtn" onclick="undoLast()">Undo</button>
  </div>

  <label>Dealer Hole & Draws</label>
  <input id="dealerDraws" placeholder="9,7,5 ‚Äî first is hole" />
  <div class="row">
    <button class="smallbtn" onclick="setDealerHole()">Set Hole & Draws</button>
    <button class="smallbtn" onclick="burnCard()">Burn Card</button>
  </div>

  <label>Other Players' Seen Cards</label>
  <input id="otherPlayers" placeholder="e.g. 10,9,K,A" />
  <div class="row">
    <button class="smallbtn" onclick="addOtherPlayers()">Add Other Cards</button>
  </div>

  <hr style="opacity:.08;margin:10px 0">

  <label>Splits / Doubles / Hand Controls</label>
  <div class="controls">
    <button class="mini" onclick="doSplit()">Split</button>
    <button class="mini" onclick="doDouble()">Double</button>
    <button class="mini" onclick="finishHand()">Finish Hand</button>
  </div>

  <hr style="opacity:.08;margin:10px 0">

  <label>Bankroll & Bets</label>
  <div class="settings">
    <div>
      <label>Total Bankroll ($)</label>
      <input id="bankroll" type="number" min="0" value="1000"/>
    </div>
    <div>
      <label>Minimum Bet ($)</label>
      <input id="minBet" type="number" min="1" value="10"/>
    </div>
  </div>

  <label>Bet Spread Mapping (CSV)</label>
  <textarea id="spreadMap" rows="2">0:1,1:2,2:4,3:8,4:12</textarea>
  <div class="row">
    <button onclick="applySpread()">Apply Spread</button>
    <button class="smallbtn" onclick="placeSuggestedBet()">Place Suggested Bet</button>
  </div>

  <hr style="opacity:.08;margin:10px 0">

  <label>Record Result</label>
  <div class="row">
    <button class="smallbtn" onclick="recordWin()">Record Win</button>
    <button class="smallbtn danger" onclick="recordLoss()">Record Loss</button>
    <button class="smallbtn" onclick="recordPush()">Push</button>
  </div>

  <hr style="opacity:.08;margin:10px 0">

  <label>Controls</label>
  <div class="row">
    <button class="smallbtn" onclick="refreshDisplay()">Refresh Display</button>
    <button class="smallbtn" onclick="saveSettings()">Save Settings</button>
    <button class="smallbtn" onclick="loadSettings()">Load Settings</button>
  </div>

  <div class="log" id="actionLog"></div>
</div>

<div class="panel">
  <div class="row">
    <div class="badge">Decks: <span id="displayDecks">6</span></div>
    <div class="badge">Rounds: <span id="roundCount">0</span></div>
    <div class="badge">Running: <span id="runningCount">0</span></div>
    <div class="badge">True: <span id="trueCount">0.00</span></div>
    <div class="badge">Remaining Decks: <span id="remDecks">6.00</span></div>
  </div>

  <div class="hands">
    <div class="hand">
      <div class="muted">Dealer (upcard + hole/draws)</div>
      <div class="cards" id="dealerCards"></div>
      <div class="muted" id="dealerStatus">Dealer hole: - ‚Ä¢ draws: -</div>
    </div>

    <div class="hand" id="handContainer">
      <div class="muted">Player Hands</div>
      <div id="playerHands"></div>
    </div>

    <div class="hand" style="min-width:220px;">
      <div class="muted">Bankroll & Bets</div>
      <div class="stat">Bankroll: $<span id="displayBankroll">1000</span></div>
      <div class="stat">Min Bet: $<span id="displayMinBet">10</span></div>
      <div class="stat">Suggested Bet: $<span id="displaySuggested">10</span></div>
      <div class="stat">Placed Bet(s): $<span id="displayPlaced">0</span></div>
      <div class="stat">Wins: <span id="wins">0</span> ‚Ä¢ Losses: <span id="losses">0</span> ‚Ä¢ Pushes: <span id="pushes">0</span></div>
    </div>
  </div>

  <hr style="opacity:.08;margin:12px 0">
  <div class="muted">Seen cards (counted):</div>
  <div id="seenList" class="log"></div>
</div>
</div>

<footer>
  <div class="center">
    <div id="countDot" class="countdot green"></div>
    <div class="muted">Card counting active</div>
  </div>
</footer>

<script>
// ===== State =====
let numDecks=6, runningCount=0, seenCards=[], burnedCards=[];
let dealer={up:null,hole:null,draws:[]};
let hands=[], activeHandIndex=0, roundCount=0;
let bankroll = 1000, minBet = 10, spreadMap=[[0,1],[1,2],[2,4],[3,8],[4,12]];
let wins=0, losses=0, pushes=0;

// Hi-Lo values
const hiLoValues={'2':1,'3':1,'4':1,'5':1,'6':1,'7':0,'8':0,'9':0,'10':-1,'J':-1,'Q':-1,'K':-1,'A':-1};

// ===== Helpers =====
function normalizeCardToken(tok){ 
  if(!tok) return null; 
  tok=tok.toUpperCase().trim(); 
  if(tok==='T') tok='10'; 
  if(tok.match(/^[2-9]|10|A|J|Q|K$/)) return tok; 
  if(['J','Q','K','A'].includes(tok)) return tok; 
  let n=parseInt(tok); 
  if(n>=2&&n<=10) return String(n); 
  return null; 
}
function cardValue(c){ if(c==='A') return 11; if(['J','Q','K'].includes(c)) return 10; return parseInt(c); }
function handTotal(cards){ let total=0, aces=0; for(let c of cards){ if(c==='A') aces++; else total+=cardValue(c); } for(let i=0;i<aces;i++){ total += (total+11<=21?11:1); } return total; }
function isSoft(cards){ return cards.includes('A') && handTotal(cards)-11<=10; }
function parseSpread(txt){ try{return txt.split(',').map(s=>{ let [k,v]=s.split(':'); return [Number(k.trim()),Number(v.trim())];}).sort((a,b)=>a[0]-b[0]);}catch(e){return [[0,1]];} }
function getTrueCount(){ const total=52*numDecks; let rem=Math.max(total-seenCards.length,1)/52; document.getElementById('remDecks').innerText=rem.toFixed(2); return runningCount/rem; }
function logAction(s){ const el=document.getElementById('actionLog'); el.innerHTML=new Date().toLocaleTimeString()+' ‚Äî '+s+'<br>'+el.innerHTML; }
function updateCountWithCard(card){ const c=normalizeCardToken(card); if(!c) return; seenCards.push(c); if(hiLoValues[c]!=null) runningCount+=hiLoValues[c]; updateDisplay(); }

// ===== UI =====
function updateDisplay(){
  document.getElementById('displayDecks').innerText=numDecks;
  document.getElementById('runningCount').innerText=runningCount;
  document.getElementById('trueCount').innerText=getTrueCount().toFixed(2);
  document.getElementById('displayBankroll').innerText=bankroll.toFixed(2);
  document.getElementById('displayMinBet').innerText=minBet;
  document.getElementById('displayPlaced').innerText=totalPlacedBets();
  document.getElementById('displaySuggested').innerText=suggestedBet();
  document.getElementById('roundCount').innerText=roundCount;
  document.getElementById('wins').innerText=wins; document.getElementById('losses').innerText=losses; document.getElementById('pushes').innerText=pushes;

  // Dealer display
  const dealerCardsEl=document.getElementById('dealerCards'); dealerCardsEl.innerHTML='';
  if(dealer.up) dealerCardsEl.appendChild(createCardEl(dealer.up));
  if(dealer.hole) dealerCardsEl.appendChild(createCardEl('üÇ†'));
  for(let d of dealer.draws) dealerCardsEl.appendChild(createCardEl(d));
  document.getElementById('dealerStatus').innerText=`Dealer up: ${dealer.up||'-'} ‚Ä¢ hole: ${dealer.hole?'set':'-'} ‚Ä¢ draws: ${dealer.draws.join(',')||'-'}`;

  renderHands();
  document.getElementById('seenList').innerText=seenCards.join(' , ');

  const dot=document.getElementById('countDot');
  dot.className='countdot '+(Math.abs(runningCount)>0?'green':'red');
}

function createCardEl(card){ const d=document.createElement('div'); d.className='card'; d.innerText=card; return d; }

function renderHands(){
  const container=document.getElementById('playerHands'); container.innerHTML='';
  hands.forEach((h,i)=>{
    const wrapper=document.createElement('div'); wrapper.style.border=i===activeHandIndex?'2px solid var(--accent)':'1px solid #06332d'; wrapper.style.padding='8px'; wrapper.style.borderRadius='8px'; wrapper.style.marginTop='8px';
    const title=document.createElement('div'); title.className='muted'; title.innerText=`Hand ${i+1} ${h.splitFrom?'(split)':''} ${h.finished?'‚Ä¢ Finished':''}`; wrapper.appendChild(title);

    const cardsEl=document.createElement('div'); cardsEl.className='cards'; h.cards.forEach(c=>cardsEl.appendChild(createCardEl(c))); wrapper.appendChild(cardsEl);

    const total=document.createElement('div'); total.className='muted'; total.innerText=`Total: ${handTotal(h.cards)} ${isSoft(h.cards)?' (Soft)':''}`; wrapper.appendChild(total);

    const advice=document.createElement('div'); advice.className='muted'; advice.innerText='Advice: '+basicStrategyAdvice(h.cards,dealer.up); wrapper.appendChild(advice);

    const mc=document.createElement('div'); mc.className='muted'; mc.innerHTML=`Monte Carlo: <span class="mcWin">Win: -</span> ‚Ä¢ <span class="mcLoss">Loss: -</span> ‚Ä¢ <span class="mcPush">Push: -</span>`; wrapper.appendChild(mc);

    // Buttons
    const btns=document.createElement('div'); btns.style.marginTop='8px';
    ['Select','Hit','Double','Finish'].forEach(act=>{
      const b=document.createElement('button'); b.className='mini'; b.innerText=act; 
      b.onclick=()=>{if(act==='Hit'){h.cards.push(prompt('Enter card seen:')||''); updateCountWithCard(h.cards[h.cards.length-1]); refreshDisplay();} 
                    else if(act==='Finish'){h.finished=true; refreshDisplay();} 
                    else if(act==='Double'){doDouble();} 
                    else if(act==='Select'){activeHandIndex=i; refreshDisplay();} };
      btns.appendChild(b);
    });
    wrapper.appendChild(btns);
    container.appendChild(wrapper);

    // Monte Carlo asynchronously
    setTimeout(()=>{
      const mcRes=monteCarloSim(h.cards,dealer.up,2000);
      mc.querySelector('.mcWin').innerText=`Win: ${mcRes.win}%`;
      mc.querySelector('.mcLoss').innerText=`Loss: ${mcRes.loss}%`;
      mc.querySelector('.mcPush').innerText=`Push: ${mcRes.push}%`;
    },50);
  });
}

// ===== Game Logic =====
function setDecks(){ numDecks=parseInt(document.getElementById('numDecks').value)||6; updateDisplay(); }
function fullReset(){ runningCount=0; seenCards=[]; hands=[]; dealer={up:null,hole:null,draws:[]}; roundCount=0; wins=0; losses=0; pushes=0; updateDisplay(); logAction('Full reset'); }
function processInput(){
  const val=document.getElementById('setup').value.trim(); if(!val) return;
  const tokens=val.split(/\s+/);
  hands=[]; activeHandIndex=0; dealer={up:null,hole:null,draws:[]};
  tokens.forEach(tok=>{
    if(tok[0].toUpperCase()==='D'){ dealer.up=normalizeCardToken(tok.slice(1)); updateCountWithCard(dealer.up); }
    else if(tok[0].toUpperCase()==='P'){ 
      let cards=tok.slice(1).split(',').map(normalizeCardToken).filter(Boolean);
      hands.push({cards:cards,splitFrom:null,finished:false});
      cards.forEach(c=>updateCountWithCard(c));
    }
    else if(tok[0].toUpperCase()==='O'){ let cards=tok.slice(1).split(',').map(normalizeCardToken).filter(Boolean); cards.forEach(c=>updateCountWithCard(c)); }
  });
  logAction('Processed input: '+val);
  updateDisplay();
}

// ===== Player Actions =====
function addCard(){ const c=normalizeCardToken(document.getElementById('addCard').value); if(!c) return; hands[activeHandIndex].cards.push(c); updateCountWithCard(c); document.getElementById('addCard').value=''; refreshDisplay(); }
function undoLast(){ if(seenCards.length===0) return; const c=seenCards.pop(); runningCount-=hiLoValues[c]||0; refreshDisplay(); }
function doSplit(){ const h=hands[activeHandIndex]; if(h.cards.length===2 && h.cards[0]===h.cards[1]){ const newHand={cards:[h.cards.pop()],splitFrom:activeHandIndex,finished:false}; hands.push(newHand); refreshDisplay(); logAction('Hand split');} }
function doDouble(){ const h=hands[activeHandIndex]; if(h.cards.length>=2){ h.cards.push(prompt('Enter card for double:')||''); updateCountWithCard(h.cards[h.cards.length-1]); h.finished=true; refreshDisplay(); logAction('Doubled hand'); } }
function finishHand(){ hands[activeHandIndex].finished=true; refreshDisplay(); logAction('Finished hand'); }
function nextRound(){ roundCount++; hands=[]; activeHandIndex=0; dealer={up:null,hole:null,draws:[]}; updateDisplay(); logAction('Next round'); }
function burnCard(){ const c=prompt('Enter burned card:'); if(c){ burnedCards.push(c); updateCountWithCard(c); refreshDisplay(); } }
function setDealerHole(){ const val=document.getElementById('dealerDraws').value.trim(); if(!val) return; const cards=val.split(',').map(normalizeCardToken).filter(Boolean); dealer.hole=cards.shift(); dealer.draws=cards; cards.forEach(c=>updateCountWithCard(c)); refreshDisplay(); }
function addOtherPlayers(){ const val=document.getElementById('otherPlayers').value.trim(); if(!val) return; val.split(',').map(normalizeCardToken).filter(Boolean).forEach(c=>updateCountWithCard(c)); document.getElementById('otherPlayers').value=''; refreshDisplay(); }

// ===== Strategy & Monte Carlo =====
function basicStrategyAdvice(cards,dealerUp){
  if(!cards.length||!dealerUp) return '-';
  const total=handTotal(cards); if(total>=17) return 'Stand';
  if(total<=11) return 'Hit';
  return total>=12&&total<=16?(['7','8','9','10','J','Q','K','A'].includes(dealerUp)?'Hit':'Stand'):'Stand';
}

function monteCarloSim(playerCards,dealerUp,iterations){
  if(!playerCards.length||!dealerUp) return {win:0,loss:0,push:0};
  let win=0,loss=0,push=0;
  for(let i=0;i<iterations;i++){
    const pTotal=handTotal(playerCards); 
    const dTotal=handTotal([dealerUp]); 
    if(pTotal>21) loss++;
    else if(dTotal>21||pTotal>dTotal) win++;
    else if(pTotal===dTotal) push++;
    else loss++;
  }
  const tot=win+loss+push; return {win:Math.round(win/tot*100),loss:Math.round(loss/tot*100),push:Math.round(push/tot*100)};
}

// ===== Bankroll & Bets =====
function applySpread(){ spreadMap=parseSpread(document.getElementById('spreadMap').value); updateDisplay(); }
function suggestedBet(){ const tc=Math.floor(getTrueCount()); for(let i=spreadMap.length-1;i>=0;i--){ if(tc>=spreadMap[i][0]) return spreadMap[i][1]*minBet; } return minBet; }
function totalPlacedBets(){ return hands.length*suggestedBet(); }
function placeSuggestedBet(){ bankroll-=totalPlacedBets(); updateDisplay(); }
function recordWin(){ wins++; bankroll+=totalPlacedBets()*2; updateDisplay(); }
function recordLoss(){ losses++; updateDisplay(); }
function recordPush(){ pushes++; bankroll+=totalPlacedBets(); updateDisplay(); }

function refreshDisplay(){ updateDisplay(); }

</script>

</body>
</html>
