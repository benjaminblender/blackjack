<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Blackjack Pro ‚Äî Hi-Lo Live Analyzer</title>
<style>
:root{--bg:#071014;--panel:#0d1a1f;--accent:#00d18a;--muted:#9aa9b0;--danger:#ff6b6b;--card:#0b2a2a;}
body{background:var(--bg);color:#ecf6f5;font-family:Inter,system-ui,Segoe UI,Arial;margin:0;padding:18px;}
header{display:flex;gap:12px;align-items:center}
h1{margin:.2rem 0;color:var(--accent)}
.container{display:grid;grid-template-columns:360px 1fr;gap:18px;margin-top:12px}
.panel{background:var(--panel);padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.6)}
label{display:block;color:var(--muted);font-size:12px;margin-top:8px}
input[type=text], input[type=number], textarea, select{width:100%;padding:8px;border-radius:8px;border:1px solid #153236;background:#071f20;color:#e8f7f2}
button{background:var(--accent);color:#00220f;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;margin-top:8px}
.smallbtn{padding:6px 8px;font-size:13px}
.row{display:flex;gap:8px;align-items:center}
.stat{margin:8px 0;padding:10px;border-radius:10px;background:linear-gradient(180deg,#062b30,#052025);font-size:14px}
.muted{color:var(--muted);font-size:13px}
.badge{display:inline-block;padding:6px 8px;border-radius:8px;background:#022523;color:#a8f6df;margin-right:6px;font-weight:600}
.danger{background:var(--danger);color:#2b0000}
.hands{display:flex;gap:12px;flex-wrap:wrap}
.hand{min-width:180px;padding:10px;border-radius:10px;background:#071f22}
.cards{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.card{background:var(--card);padding:8px 10px;border-radius:8px;min-width:30px;text-align:center;font-weight:700}
footer{position:fixed;left:18px;bottom:18px;display:flex;align-items:center;gap:10px}
.countdot{width:14px;height:14px;border-radius:50%;display:inline-block;border:2px solid #0a2f26}
.green{background:#17d18a;box-shadow:0 0 8px #17d18a66}
.red{background:#ff6b6b;box-shadow:0 0 8px #ff6b6b66}
.log{max-height:160px;overflow:auto;padding:8px;background:#051517;border-radius:8px;margin-top:8px;font-size:13px}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.mini{font-size:13px;padding:6px 8px}
.center{display:flex;align-items:center;gap:8px}
.settings{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.hint{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<header>
  <div>
    <h1>üÉè Blackjack Pro ‚Äî Hi-Lo Live Analyzer</h1>
    <div class="muted">Continuous count ‚Ä¢ Splits, doubles ‚Ä¢ Dealer draws & other players ‚Ä¢ Bankroll & custom bet spread ‚Ä¢ Strategy advice</div>
  </div>
</header>
<div class="container">
  <div class="panel">
    <label>Decks (N#) ‚Äî set number of decks and start a new shoe</label>
    <div class="row">
      <input id="numDecks" type="number" min="1" max="8" value="6"/>
      <button class="smallbtn" onclick="setDecks()">Set N</button>
      <button class="smallbtn" onclick="fullReset()">Reset All</button>
    </div>
    <label>Initial Setup (type then click Analyze)</label>
    <input id="setup" placeholder="Example: N6 D10 M9 P7" />
    <div class="row">
      <button onclick="processInput()">Analyze / Start Hand</button>
      <button onclick="nextRound()" class="smallbtn">Next Round (keep count)</button>
    </div>
    <div class="hint">Use letters: D=dealer upcard, M=your first card, P=other players‚Äô cards. J,Q,K,A or numbers 2-10.</div>
    <hr style="opacity:.08;margin:10px 0">
    <label>Add Player Card (Hit / Double etc.)</label>
    <div class="row">
      <input id="addCard" placeholder="e.g. 7  OR P3 for other players" />
      <button onclick="addCard()" class="smallbtn">Add</button>
      <button onclick="undoLast()" class="smallbtn">Undo</button>
    </div>
    <div class="hint">Add one card at a time. For Double, after adding click 'Double'.</div>
    <label>Dealer Hole & Draws</label>
    <input id="dealerDraws" placeholder="Hole first, then draws: 9,7,5" />
    <div class="row">
      <button onclick="setDealerHole()" class="smallbtn">Set Hole & Draws</button>
      <button onclick="burnCard()" class="smallbtn">Burn Card</button>
    </div>
    <label>Other Players' Seen Cards</label>
    <input id="otherPlayers" placeholder="e.g. 10,9,K,A" />
    <div class="row">
      <button onclick="addOtherPlayers()" class="smallbtn">Add Other Cards</button>
    </div>
    <hr style="opacity:.08;margin:10px 0">
    <label>Splits / Doubles / Hand Controls</label>
    <div class="controls">
      <button onclick="doSplit()" class="mini">Split</button>
      <button onclick="doDouble()" class="mini">Double</button>
      <button onclick="finishHand()" class="mini">Finish Hand</button>
    </div>
    <hr style="opacity:.08;margin:10px 0">
    <label>Bankroll & Betting</label>
    <div class="settings">
      <div>
        <label>Total Bankroll ($)</label>
        <input id="bankroll" type="number" min="0" value="1000"/>
      </div>
      <div>
        <label>Minimum Bet ($)</label>
        <input id="minBet" type="number" min="1" value="10"/>
      </div>
    </div>
    <label>Bet Spread Mapping (simple CSV):</label>
    <textarea id="spreadMap" rows="2" placeholder="Example: 0:1,1:2,2:4,3:8,4:12">0:1,1:2,2:4,3:8,4:12</textarea>
    <div class="row">
      <button onclick="applySpread()">Apply Spread</button>
      <button onclick="placeSuggestedBet()" class="smallbtn">Place Suggested Bet</button>
    </div>
    <hr style="opacity:.08;margin:10px 0">
    <label>Record Result</label>
    <div class="row">
      <button onclick="recordWin()" class="smallbtn">Record Win</button>
      <button onclick="recordLoss()" class="smallbtn danger">Record Loss</button>
      <button onclick="recordPush()" class="smallbtn">Push</button>
    </div>
    <hr style="opacity:.08;margin:10px 0">
    <label>Controls</label>
    <div class="row">
      <button onclick="refreshDisplay()" class="smallbtn">Refresh Display</button>
      <button onclick="saveSettings()" class="smallbtn">Save Settings</button>
      <button onclick="loadSettings()" class="smallbtn">Load Settings</button>
    </div>
    <div style="margin-top:10px" class="log" id="actionLog"></div>
  </div>

  <div class="panel">
    <div class="row">
      <div class="badge">Decks: <span id="displayDecks">6</span></div>
      <div class="badge">Rounds: <span id="roundCount">0</span></div>
      <div class="badge">Running: <span id="runningCount">0</span></div>
      <div class="badge">True: <span id="trueCount">0.00</span></div>
      <div class="badge">Remaining Decks: <span id="remDecks">6.00</span></div>
    </div>

    <div style="margin-top:12px" class="hands">
      <div class="hand">
        <div class="muted">Dealer (upcard + hole/draws)</div>
        <div class="cards" id="dealerCards"></div>
        <div class="muted" id="dealerStatus">Dealer hole: -  ‚Ä¢ draws: -</div>
      </div>

      <div id="handContainer" class="hand" style="min-width:260px;">
        <div class="muted">Player Hands & Strategy Advice</div>
        <div id="playerHands"></div>
      </div>

      <div class="hand" style="min-width:220px;">
        <div class="muted">Bankroll & Bets</div>
        <div class="stat">Bankroll: $<span id="displayBankroll">1000</span></div>
        <div class="stat">Min Bet: $<span id="displayMinBet">10</span></div>
        <div class="stat">Suggested Bet: $<span id="displaySuggested">10</span></div>
        <div class="stat">Placed Bet(s): $<span id="displayPlaced">0</span></div>
        <div class="stat">Wins: <span id="wins">0</span> ‚Ä¢ Losses: <span id="losses">0</span> ‚Ä¢ Pushes: <span id="pushes">0</span></div>
      </div>
    </div>

    <hr style="opacity:.08;margin:12px 0">

    <div class="muted">Seen cards (counted):</div>
    <div id="seenList" class="log" style="margin-top:8px;"></div>

  </div>
</div>

<footer>
  <div class="center">
    <div id="countDot" class="countdot green"></div>
    <div class="muted">Card counting active</div>
  </div>
</footer>

<script>
/* ====== State ====== */
let numDecks = 6;
let runningCount = 0;
let seenCards = [];
let burnedCards = [];
let dealer = { up: null, hole: null, draws: [] };
let hands = [];
let activeHandIndex = 0;
let roundCount = 0;

let bankroll = Number(localStorage.getItem('bj_bankroll')) || 1000;
let minBet = Number(localStorage.getItem('bj_minBet')) || 10;
let spreadMap = parseSpread(localStorage.getItem('bj_spread') || '0:1,1:2,2:4,3:8,4:12');

let wins = Number(localStorage.getItem('bj_wins')) || 0;
let losses = Number(localStorage.getItem('bj_losses')) || 0;
let pushes = Number(localStorage.getItem('bj_pushes')) || 0;

/* ====== Hi-Lo table ====== */
const hiLoValues = { '2':1,'3':1,'4':1,'5':1,'6':1,'7':0,'8':0,'9':0,'10':-1,'J':-1,'Q':-1,'K':-1,'A':-1 };

/* ====== Helpers ====== */
function normalizeCardToken(tok){
  if(!tok) return null;
  tok = String(tok).trim().toUpperCase();
  if(tok === 'T') tok='10';
  tok = tok.replace(/[^0-9AJQK]/g,'').toUpperCase();
  if(tok==='') return null;
  if(['J','Q','K','A'].includes(tok) || /^[2-9]|10$/.test(tok)) return tok;
  return null;
}
function cardValue(card){
  if(card==='A') return 11;
  if(['J','Q','K'].includes(card)) return 10;
  return parseInt(card);
}
function handTotal(cards){
  let total=0, aces=0;
  for(let c of cards){ if(c==='A') aces++; else total+=cardValue(c); }
  for(let i=0;i<aces;i++){ total += (total+11<=21)?11:1; }
  return total;
}
function isSoft(cards){ return cards.includes('A') && handTotal(cards)-11<=10; }
function parseSpread(txt){
  if(!txt) return [[0,1]];
  try{
    return txt.split(',').map(s=>{ let [k,v]=s.split(':').map(x=>x.trim()); return [Number(k), Number(v)]; }).sort((a,b)=>a[0]-b[0]);
  }catch(e){return [[0,1]];}
}
function getTrueCount(){
  const totalCards = numDecks*52;
  const remaining = Math.max(totalCards - seenCards.length,1);
  let remDecks = remaining/52;
  if(remDecks<0.0625) remDecks=0.0625;
  document.getElementById('remDecks').innerText = remDecks.toFixed(2);
  return runningCount / remDecks;
}
function logAction(s){ const el = document.getElementById('actionLog'); el.innerHTML = new Date().toLocaleTimeString()+' ‚Äî '+s+'<br>'+el.innerHTML; }
function updateCountWithCard(card){
  const c = normalizeCardToken(card);
  if(!c) return;
  seenCards.push(c);
  if(hiLoValues.hasOwnProperty(c)) runningCount += hiLoValues[c];
  updateDisplay();
}
function updateDisplay(){
  document.getElementById('displayDecks').innerText=numDecks;
  document.getElementById('runningCount').innerText=runningCount;
  const tc=getTrueCount();
  document.getElementById('trueCount').innerText=tc.toFixed(2);
  document.getElementById('displayBankroll').innerText=bankroll.toFixed(2);
  document.getElementById('displayMinBet').innerText=minBet;
  document.getElementById('displayPlaced').innerText=totalPlacedBets();
  document.getElementById('displaySuggested').innerText=suggestedBet();
  document.getElementById('roundCount').innerText=roundCount;
  const dealerCardsEl=document.getElementById('dealerCards'); dealerCardsEl.innerHTML='';
  if(dealer.up) dealerCardsEl.appendChild(createCardEl(dealer.up));
  if(dealer.hole) dealerCardsEl.appendChild(createCardEl('üÇ†'));
  for(let d of dealer.draws) dealerCardsEl.appendChild(createCardEl(d));
  document.getElementById('dealerStatus').innerText = `Dealer up: ${dealer.up || '-'} ‚Ä¢ hole: ${dealer.hole?'set':'-'} ‚Ä¢ draws: ${dealer.draws.join(',') || '-'}`;
  renderHands();
  document.getElementById('seenList').innerText = seenCards.join(' , ');
  const dot=document.getElementById('countDot'); dot.className='countdot '+(Math.abs(runningCount)>0?'green':'red');
  localStorage.setItem('bj_bankroll',bankroll); localStorage.setItem('bj_minBet',minBet);
  localStorage.setItem('bj_spread',document.getElementById('spreadMap').value);
  localStorage.setItem('bj_wins',wins); localStorage.setItem('bj_losses',losses); localStorage.setItem('bj_pushes',pushes);
  document.getElementById('wins').innerText=wins; document.getElementById('losses').innerText=losses; document.getElementById('pushes').innerText=pushes;
}

/* ====== UI helpers ====== */
function createCardEl(card){ const div=document.createElement('div'); div.className='card'; div.innerText=card; return div; }
function renderHands(){
  const container=document.getElementById('playerHands'); container.innerHTML='';
  hands.forEach((h,i)=>{
    const wrapper=document.createElement('div'); wrapper.style.border=i===activeHandIndex?'2px solid var(--accent)':'1px solid #06332d';
    wrapper.style.padding='8px'; wrapper.style.borderRadius='8px'; wrapper.style.marginTop='8px';
    const title=document.createElement('div'); title.className='muted';
    title.innerText=`Hand ${i+1} ${h.splitFrom?'(split)':''} ${h.finished?'‚Ä¢ Finished':''}`;
    wrapper.appendChild(title);
    const cardsDiv=document.createElement('div'); cardsDiv.className='cards';
    h.cards.forEach(c=>cardsDiv.appendChild(createCardEl(c)));
    wrapper.appendChild(cardsDiv);
    const advice=document.createElement('div'); advice.className='muted';
    advice.innerText='‚Üí '+getAdvice(h.cards,dealer.up);
    wrapper.appendChild(advice);
    container.appendChild(wrapper);
  });
}

/* ====== Blackjack Strategy (basic) ====== */
function getAdvice(cards, dealerUp){
  if(!cards || !cards.length || !dealerUp) return '-';
  const total=handTotal(cards);
  const soft=isSoft(cards);
  if(cards.length===2){
    // Check for split
    if(cards[0]===cards[1]){
      if(['A','8'].includes(cards[0])) return 'Split';
      if(['2','3','7'].includes(cards[0]) && ['2','3','4','5','6','7'].includes(dealerUp)) return 'Split';
      if(cards[0]==='6' && ['2','3','4','5','6'].includes(dealerUp)) return 'Split';
      if(cards[0]==='9' && !['7','10','A'].includes(dealerUp)) return 'Split';
    }
    // Check for double
    if(!soft){
      if(total===11) return 'Double if allowed, else Hit';
      if(total===10 && !['10','A'].includes(dealerUp)) return 'Double if allowed, else Hit';
      if(total===9 && ['3','4','5','6'].includes(dealerUp)) return 'Double if allowed, else Hit';
    }
  }
  if(soft){
    if(total<=17) return 'Hit';
    if(total===18 && ['9','10','A'].includes(dealerUp)) return 'Hit'; 
    return 'Stand';
  }
  if(total>=17) return 'Stand';
  if(total>=13 && total<=16 && ['2','3','4','5','6'].includes(dealerUp)) return 'Stand';
  if(total===12 && ['4','5','6'].includes(dealerUp)) return 'Stand';
  return 'Hit';
}

/* ====== Hand Processing ====== */
function processInput(){
  const text=document.getElementById('setup').value.trim();
  if(!text) return;
  const tokens=text.split(/\s+/);
  hands=[]; dealer={up:null,hole:null,draws:[]}; runningCount=0; seenCards=[];
  tokens.forEach(p=>{
    if(p.startsWith('N')){ numDecks=parseInt(p.slice(1)) || 6; return; }
    if(p.startsWith('D')){ dealer.up=normalizeCardToken(p.slice(1)); updateCountWithCard(dealer.up); return; }
    if(p.startsWith('M')){ let c=normalizeCardToken(p.slice(1)); hands.push({cards:[c], splitFrom:null, finished:false}); updateCountWithCard(c); return; }
    if(p.startsWith('P')){ let c=normalizeCardToken(p.slice(1)); if(c) updateCountWithCard(c); logAction('Other player card seen (via P): '+c); return; }
  });
  roundCount++;
  updateDisplay();
}

function addCard(){
  const val=document.getElementById('addCard').value.trim();
  if(!val) return;
  const token=val.toUpperCase();
  if(token.startsWith('P')){
    let c=normalizeCardToken(token.slice(1)); if(c){ updateCountWithCard(c); logAction('Other player card seen: '+c); }
  } else {
    let c=normalizeCardToken(token);
    if(c && hands[activeHandIndex]){ hands[activeHandIndex].cards.push(c); updateCountWithCard(c); logAction('Added card '+c+' to hand '+(activeHandIndex+1)); }
  }
  document.getElementById('addCard').value='';
  updateDisplay();
}

function doSplit(){
  const h=hands[activeHandIndex]; if(!h || h.cards.length!==2 || h.cards[0]!==h.cards[1]) return;
  const card=h.cards.pop();
  hands.push({cards:[card], splitFrom:activeHandIndex, finished:false});
  logAction('Hand '+(activeHandIndex+1)+' split.');
  updateDisplay();
}
function doDouble(){ const h=hands[activeHandIndex]; if(!h) return; logAction('Hand '+(activeHandIndex+1)+' doubled.'); }
function finishHand(){ if(hands[activeHandIndex]) hands[activeHandIndex].finished=true; activeHandIndex=(activeHandIndex+1)%hands.length; updateDisplay(); }

function nextRound(){ hands=[]; dealer={up:null,hole:null,draws:[]}; activeHandIndex=0; roundCount++; updateDisplay(); }

function setDecks(){ numDecks=Math.max(1,parseInt(document.getElementById('numDecks').value)||6); updateDisplay(); }
function fullReset(){ runningCount=0; seenCards=[]; burnedCards=[]; hands=[]; dealer={up:null,hole:null,draws:[]}; roundCount=0; wins=0; losses=0; pushes=0; updateDisplay(); }

function setDealerHole(){ const val=document.getElementById('dealerDraws').value.trim().split(/[,\s]+/); dealer.hole=normalizeCardToken(val[0]); dealer.draws=val.slice(1).map(x=>normalizeCardToken(x)).filter(Boolean); if(dealer.hole) updateCountWithCard(dealer.hole); dealer.draws.forEach(c=>updateCountWithCard(c)); updateDisplay(); }
function burnCard(){ const val=document.getElementById('dealerDraws').value.trim(); if(!val) return; let c=normalizeCardToken(val); if(c){ burnedCards.push(c); updateCountWithCard(c); logAction('Burned card: '+c); updateDisplay(); } }
function addOtherPlayers(){ const val=document.getElementById('otherPlayers').value.trim().split(/[,\s]+/); val.forEach(c=>{ let cc=normalizeCardToken(c); if(cc){ updateCountWithCard(cc); logAction('Other player card added: '+cc); } }); updateDisplay(); }

function applySpread(){ spreadMap=parseSpread(document.getElementById('spreadMap').value); updateDisplay(); }
function suggestedBet(){ const tc=Math.floor(getTrueCount()); for(let i=spreadMap.length-1;i>=0;i--){ if(tc>=spreadMap[i][0]) return spreadMap[i][1]*minBet; } return minBet; }
function totalPlacedBets(){ return hands.length*suggestedBet(); }

function recordWin(){ wins++; bankroll+=totalPlacedBets(); logAction('Recorded WIN'); updateDisplay(); }
function recordLoss(){ losses++; bankroll-=totalPlacedBets(); logAction('Recorded LOSS'); updateDisplay(); }
function recordPush(){ pushes++; logAction('Recorded PUSH'); updateDisplay(); }

function refreshDisplay(){ updateDisplay(); }
function saveSettings(){ localStorage.setItem('bj_bankroll',bankroll); localStorage.setItem('bj_minBet',minBet); localStorage.setItem('bj_spread',document.getElementById('spreadMap').value); }
function loadSettings(){ bankroll=Number(localStorage.getItem('bj_bankroll'))||1000; minBet=Number(localStorage.getItem('bj_minBet'))||10; spreadMap=parseSpread(localStorage.getItem('bj_spread')||'0:1,1:2,2:4,3:8,4:12'); updateDisplay(); }
</script>
</body>
</html>
