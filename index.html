<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Blackjack Pro ‚Äî Hi-Lo Live Analyzer with Monte Carlo</title>
<style>
:root{--bg:#071014;--panel:#0d1a1f;--accent:#00d18a;--muted:#9aa9b0;--danger:#ff6b6b;--card:#0b2a2a;}
body{background:var(--bg);color:#ecf6f5;font-family:Inter,system-ui,Segoe UI,Arial;margin:0;padding:18px;}
header{display:flex;gap:12px;align-items:center} h1{margin:.2rem 0;color:var(--accent)}
.container{display:grid;grid-template-columns:360px 1fr;gap:18px;margin-top:12px}
.panel{background:var(--panel);padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.6)}
label{display:block;color:var(--muted);font-size:12px;margin-top:8px}
input[type=text], input[type=number], textarea, select{width:100%;padding:8px;border-radius:8px;border:1px solid #153236;background:#071f20;color:#e8f7f2}
button{background:var(--accent);color:#00220f;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;margin-top:8px}
.smallbtn{padding:6px 8px;font-size:13px} .row{display:flex;gap:8px;align-items:center}
.stat{margin:8px 0;padding:10px;border-radius:10px;background:linear-gradient(180deg,#062b30,#052025);font-size:14px}
.muted{color:var(--muted);font-size:13px} .badge{display:inline-block;padding:6px 8px;border-radius:8px;background:#022523;color:#a8f6df;margin-right:6px;font-weight:600}
.danger{background:var(--danger);color:#2b0000}
.hands{display:flex;gap:12px;flex-wrap:wrap} .hand{min-width:180px;padding:10px;border-radius:10px;background:#071f22}
.cards{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px} .card{background:var(--card);padding:8px 10px;border-radius:8px;min-width:30px;text-align:center;font-weight:700}
footer{position:fixed;left:18px;bottom:18px;display:flex;align-items:center;gap:10px}
.countdot{width:14px;height:14px;border-radius:50%;display:inline-block;border:2px solid #0a2f26}
.green{background:#17d18a;box-shadow:0 0 8px #17d18a66}
.red{background:#ff6b6b;box-shadow:0 0 8px #ff6b6b66}
.log{max-height:160px;overflow:auto;padding:8px;background:#051517;border-radius:8px;margin-top:8px;font-size:13px}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px} .mini{font-size:13px;padding:6px 8px}
.center{display:flex;align-items:center;gap:8px} .settings{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.hint{font-size:13px;color:var(--muted)}
</style>
</head>
<body>

<header>
<div>
<h1>üÉè Blackjack Pro ‚Äî Hi-Lo Live Analyzer + Monte Carlo</h1>
<div class="muted">Continuous count ‚Ä¢ Splits, doubles ‚Ä¢ Dealer draws & other players ‚Ä¢ Strategy & Probabilities</div>
</div>
</header>

<div class="container">
<div class="panel">
<label>Decks (N#) ‚Äî set number of decks and start a new shoe</label>
<div class="row">
<input id="numDecks" type="number" min="1" max="8" value="6"/>
<button class="smallbtn" onclick="setDecks()">Set N</button>
<button class="smallbtn" onclick="fullReset()">Reset All</button>
</div>

<label>Initial Setup (type then click Analyze)</label>
<input id="setup" placeholder="Example: N6 D10 M9 P7"/>
<div class="row">
<button onclick="processInput()">Analyze / Start Hand</button>
<button onclick="nextRound()" class="smallbtn">Next Round</button>
</div>
<div class="hint">Use D=dealer upcard, M=your first card, P=other players' cards. J,Q,K,A or 2-10.</div>

<hr style="opacity:.08;margin:10px 0">

<label>Add Player Card</label>
<div class="row">
<input id="addCard" placeholder="e.g. P3 or just 3"/>
<button onclick="addCard()" class="smallbtn">Add</button>
<button onclick="undoLast()" class="smallbtn">Undo</button>
</div>

<label>Dealer Hole & Draws</label>
<input id="dealerDraws" placeholder="Hole then draws, e.g. 9,7,5"/>
<div class="row">
<button onclick="setDealerHole()" class="smallbtn">Set Hole & Draws</button>
<button onclick="burnCard()" class="smallbtn">Burn Card</button>
</div>

<hr style="opacity:.08;margin:10px 0">

<label>Splits / Doubles / Hand Controls</label>
<div class="controls">
<button onclick="doSplit()" class="mini">Split</button>
<button onclick="doDouble()" class="mini">Double</button>
<button onclick="finishHand()" class="mini">Finish Hand</button>
</div>

<hr style="opacity:.08;margin:10px 0">

<label>Bankroll & Betting</label>
<div class="settings">
<div>
<label>Total Bankroll ($)</label>
<input id="bankroll" type="number" min="0" value="1000"/>
</div>
<div>
<label>Minimum Bet ($)</label>
<input id="minBet" type="number" min="1" value="10"/>
</div>
</div>

<label>Bet Spread Mapping (CSV)</label>
<textarea id="spreadMap" rows="2">0:1,1:2,2:4,3:8,4:12</textarea>
<div class="row">
<button onclick="applySpread()">Apply Spread</button>
<button onclick="placeSuggestedBet()" class="smallbtn">Place Suggested Bet</button>
</div>

<hr style="opacity:.08;margin:10px 0">

<label>Record Result</label>
<div class="row">
<button onclick="recordWin()" class="smallbtn">Win</button>
<button onclick="recordLoss()" class="smallbtn danger">Loss</button>
<button onclick="recordPush()" class="smallbtn">Push</button>
</div>

<hr style="opacity:.08;margin:10px 0">

<div class="row">
<button onclick="refreshDisplay()" class="smallbtn">Refresh Display</button>
<button onclick="saveSettings()" class="smallbtn">Save Settings</button>
<button onclick="loadSettings()" class="smallbtn">Load Settings</button>
</div>

<div style="margin-top:10px" class="log" id="actionLog"></div>
</div>

<div class="panel">
<div class="row">
<div class="badge">Decks: <span id="displayDecks">6</span></div>
<div class="badge">Rounds: <span id="roundCount">0</span></div>
<div class="badge">Running: <span id="runningCount">0</span></div>
<div class="badge">True: <span id="trueCount">0.00</span></div>
<div class="badge">Remaining Decks: <span id="remDecks">6.00</span></div>
</div>

<div style="margin-top:12px" class="hands">
<div class="hand">
<div class="muted">Dealer (upcard + hole/draws)</div>
<div class="cards" id="dealerCards"></div>
<div class="muted" id="dealerStatus">Dealer hole: -  ‚Ä¢ draws: -</div>
</div>

<div id="handContainer" class="hand" style="min-width:260px;">
<div class="muted">Player Hands</div>
<div id="playerHands"></div>
</div>

<div class="hand" style="min-width:220px;">
<div class="muted">Bankroll & Bets</div>
<div class="stat">Bankroll: $<span id="displayBankroll">1000</span></div>
<div class="stat">Min Bet: $<span id="displayMinBet">10</span></div>
<div class="stat">Suggested Bet: $<span id="displaySuggested">10</span></div>
<div class="stat">Placed Bet(s): $<span id="displayPlaced">0</span></div>
<div class="stat">Wins: <span id="wins">0</span> ‚Ä¢ Losses: <span id="losses">0</span> ‚Ä¢ Pushes: <span id="pushes">0</span></div>
</div>
</div>

<hr style="opacity:.08;margin:12px 0">

<div class="muted">Seen cards (counted):</div>
<div id="seenList" class="log" style="margin-top:8px;"></div>
</div>
</div>

<footer>
<div class="center">
<div id="countDot" class="countdot green"></div>
<div class="muted">Card counting active</div>
</div>
</footer>

<script>
/* ====== State ====== */
let numDecks=6,runningCount=0,seenCards=[],burnedCards=[];
let dealer={up:null,hole:null,draws:[]};
let hands=[],activeHandIndex=0,roundCount=0;
let bankroll=Number(localStorage.getItem('bj_bankroll'))||1000;
let minBet=Number(localStorage.getItem('bj_minBet'))||10;
let spreadMap=parseSpread(localStorage.getItem('bj_spread')||'0:1,1:2,2:4,3:8,4:12');
let wins=Number(localStorage.getItem('bj_wins'))||0,losses=Number(localStorage.getItem('bj_losses'))||0,pushes=Number(localStorage.getItem('bj_pushes'))||0;
const hiLoValues={'2':1,'3':1,'4':1,'5':1,'6':1,'7':0,'8':0,'9':0,'10':-1,'J':-1,'Q':-1,'K':-1,'A':-1};

/* ====== Helpers ====== */
function normalizeCardToken(tok){ if(!tok)return null; tok=String(tok).trim().toUpperCase();
if(tok==='T') tok='10'; if(tok.match(/^[2-9]|10|A|J|Q|K$/)) return tok; let n=parseInt(tok);
if(n>=2&&n<=10) return String(n); return null;}

function cardValue(card){if(card==='A')return 11;if(['K','Q','J'].includes(card))return 10;return parseInt(card);}
function handTotal(hand){let total=hand.reduce((s,c)=>s+cardValue(c),0),aces=hand.filter(c=>c==='A').length;
while(total>21&&aces>0){total-=10;aces--; } return total;}
function parseSpread(str){let m={};if(!str) return m; str.split(',').forEach(p=>{let [k,v]=p.split(':');m[Number(k)]=Number(v)}); return m;}
function getSuggestedBet(){let trueC=getTrueCount();for(let t in spreadMap){if(trueC>=t)return spreadMap[t];}return minBet;}
function getTrueCount(){let remDecks=numDecks-(seenCards.length+burnedCards.length)/52; return remDecks>0?runningCount/remDecks:runningCount;}
function logAction(msg){document.getElementById('actionLog').innerHTML+=msg+'<br>';}

/* ====== Deck & Counting ====== */
function setDecks(){numDecks=Number(document.getElementById('numDecks').value);fullReset();}
function fullReset(){runningCount=0;seenCards=[];burnedCards=[];dealer={up:null,hole:null,draws:[]};hands=[];activeHandIndex=0;roundCount=0;refreshDisplay();}
function processInput(){
let txt=document.getElementById('setup').value.split(' ');hands=[];activeHandIndex=0;
txt.forEach(tok=>{tok=tok.trim(); if(!tok) return;
let c=normalizeCardToken(tok.substring(1)); if(!c) return;
if(tok[0]==='D') dealer.up=c; else if(tok[0]==='M') hands.push({cards:[c],status:'active'}); 
else if(tok[0]==='P') seenCards.push(c); runningCount+=hiLoValues[c]||0;
}); refreshDisplay(); updateTrueCount();}
function addCard(){
let c=normalizeCardToken(document.getElementById('addCard').value); if(!c) return;
hands[activeHandIndex].cards.push(c);seenCards.push(c);runningCount+=hiLoValues[c]||0; refreshDisplay();}
function undoLast(){if(hands[activeHandIndex].cards.length>0){let c=hands[activeHandIndex].cards.pop();runningCount-=(hiLoValues[c]||0);seenCards.pop();refreshDisplay();}}
function burnCard(){let c=normalizeCardToken(prompt('Burn card:')); if(!c)return;burnedCards.push(c);runningCount+=hiLoValues[c]||0;refreshDisplay();}
function setDealerHole(){let txt=document.getElementById('dealerDraws').value.split(',');dealer.hole=normalizeCardToken(txt[0]);dealer.draws=txt.slice(1).map(c=>normalizeCardToken(c));dealerStatus();updateCounts();refreshDisplay();}
function dealerStatus(){document.getElementById('dealerStatus').innerText=`Dealer hole: ${dealer.hole||'-'} ‚Ä¢ draws: ${dealer.draws.join(',')||'-'}`;}
function updateCounts(){let allCards=[dealer.up,dealer.hole,...dealer.draws].filter(Boolean);allCards.forEach(c=>{seenCards.push(c);runningCount+=hiLoValues[c]||0;});}

/* ====== Player Controls ====== */
function doSplit(){let h=hands[activeHandIndex];if(h.cards.length==2&&h.cards[0]===h.cards[1]){hands.splice(activeHandIndex+1,0,{cards:[h.cards[1]],status:'active'});h.cards=[h.cards[0]];refreshDisplay();}}
function doDouble(){let h=hands[activeHandIndex];h.cards.push(prompt('Double card:'));finishHand();}
function finishHand(){hands[activeHandIndex].status='finished';if(activeHandIndex<hands.length-1) activeHandIndex++; refreshDisplay();}

/* ====== Betting & Bankroll ====== */
function applySpread(){spreadMap=parseSpread(document.getElementById('spreadMap').value);}
function placeSuggestedBet(){let bet=getSuggestedBet();document.getElementById('displayPlaced').innerText=bet;}
function recordWin(){wins++;bankroll+=getSuggestedBet();updateStats();}
function recordLoss(){losses++;bankroll-=getSuggestedBet();updateStats();}
function recordPush(){pushes++;updateStats();}
function updateStats(){document.getElementById('displayBankroll').innerText=bankroll;document.getElementById('wins').innerText=wins;document.getElementById('losses').innerText=losses;document.getElementById('pushes').innerText=pushes;}

/* ====== Display ====== */
function refreshDisplay(){
document.getElementById('displayDecks').innerText=numDecks;
document.getElementById('roundCount').innerText=roundCount;
document.getElementById('runningCount').innerText=runningCount;
document.getElementById('trueCount').innerText=getTrueCount().toFixed(2);
document.getElementById('remDecks').innerText=(numDecks-(seenCards.length+burnedCards.length)/52).toFixed(2);

let ph=document.getElementById('playerHands'); ph.innerHTML='';hands.forEach((h,i)=>{
let tot=handTotal(h.cards); let mc=monteCarloSim(h.cards,dealer.up,5000);
let advice=basicStrategy(h.cards,dealer.up);
let handDiv=document.createElement('div');handDiv.className='hand';
handDiv.innerHTML=`<div class="cards">${h.cards.map(c=>'<div class="card">'+c+'</div>').join('')}</div>
<div class="muted">Total: ${tot} ‚Ä¢ ${h.status}</div>
<div class="muted">Advice: ${advice}</div>
<div class="muted">Monte Carlo Win: ${mc.win}% ‚Ä¢ Loss: ${mc.loss}% ‚Ä¢ Push: ${mc.push}%</div>`;
ph.appendChild(handDiv);
});
let dc=document.getElementById('dealerCards');dc.innerHTML=[dealer.up,dealer.hole,...dealer.draws].filter(Boolean).map(c=>'<div class="card">'+c+'</div>').join('');
document.getElementById('seenList').innerText=seenCards.join(', ');}
function nextRound(){roundCount++;hands=[];activeHandIndex=0;refreshDisplay();}

/* ====== Basic Strategy (simplified, assumes stand on 17, dealer 17S) ====== */
function basicStrategy(cards, dealerUp){
let tot=handTotal(cards);
if(cards.length==2&&cards[0]===cards[1]){
if(cards[0]==='A'||cards[0]==='8') return 'Split';}
if(tot<=11) return 'Hit';
if(tot>=17) return 'Stand';
if(tot>=12&&tot<=16){
if(['2','3','4','5','6'].includes(dealerUp)) return 'Stand';
return 'Hit';}
return 'Stand';}

/* ====== Monte Carlo Simulation ====== */
function monteCarloSim(playerCards,dealerUp,N){
let wins=0,losses=0,pushes=0; const playerTotal=handTotal(playerCards);
for(let i=0;i<N;i++){
let deck=getShuffledDeck();
let dUp=dealerUp; let dHole=deck.pop(); let dealerHand=[dUp,dHole];
let pTotal=playerTotal;
while(handTotal(dealerHand)<17){dealerHand.push(deck.pop());}
let dTotal=handTotal(dealerHand);
if(pTotal>21||pTotal<dTotal&&dTotal<=21) losses++;
else if(pTotal===dTotal|| (pTotal>21 && dTotal>21)) pushes++;
else wins++;}
return {win:((wins/N)*100).toFixed(0),loss:((losses/N)*100).toFixed(0),push:((pushes/N)*100).toFixed(0)};}

function getShuffledDeck(){
let d=[];let ranks=['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
for(let i=0;i<numDecks;i++){ranks.forEach(r=>{for(let j=0;j<4;j++)d.push(r);});}
d=d.filter(c=>!seenCards.includes(c)&&!burnedCards.includes(c));
for(let i=d.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[d[i],d[j]]=[d[j],d[i]];}
return d;
}

/* ====== Settings Storage ====== */
function saveSettings(){localStorage.setItem('bj_bankroll',bankroll);localStorage.setItem('bj_minBet',minBet);localStorage.setItem('bj_spread',document.getElementById('spreadMap').value);}
function loadSettings(){bankroll=Number(localStorage.getItem('bj_bankroll'))||1000;minBet=Number(localStorage.getItem('bj_minBet'))||10;spreadMap=parseSpread(localStorage.getItem('bj_spread')||'0:1,1:2,2:4,3:8,4:12');refreshDisplay();}
</script>
</body>
</html>
